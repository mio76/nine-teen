<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–î–µ–≤`—è—Ç–Ω–∞—à–∫–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <link rel="manifest" href="manifest.json">

  <style>

html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Verdana, sans-serif;
  }

  :root{
    --fs: 1.5em;
  }

    body {
      background: #FBF2EA;
      padding: 1em;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
    margin-top: 1vh;
    }

    .controls {
      margin: 1em 0;
    }

    .grid {
      display: grid;
      width: 90vw;
      height: auto;
      gap: 5px;
      margin-bottom: 1em;
      max-width: 400px;
      aspect-ratio: 4 / 5;
      grid-template-columns: repeat(4, 1fr);
    }

    @media (orientation: landscape) {
      .grid {
        grid-template-columns: repeat(5, 1fr);
        aspect-ratio: 5 / 4;
      }
    }    

    .cell {
  background: url('check.svg') no-repeat center center;
  background-size: contain;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 0;
  padding-bottom: 100%;
  position: relative;
}

   .cell span {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: var(--fs);      /* –†–∞–∑–º–µ—Ä —Ü–∏—Ñ—Ä */
  color: #fff;         /* –¶–≤–µ—Ç —Ü–∏—Ñ—Ä */
}

    .empty {
      background: #FBF2EA;
      }      

    footer {
      max-width: 600px;
      font-size: 1.3em;
      color: #8D5131;
    }
  
    @media (min-width: 768px) and (max-width: 1024px) {
  .grid {
    font-size: 2.5em;
    max-width: 600px;
  }
}

#moveCounter {
  font-size: 1.2em;
  margin-top: 0.5em;
  color: #333;
  font-weight: bold;
}

.controls button{
  background: #D3A573;
  color: white;
  font-size: var(--fs);
  border-radius: 12px;
  padding: 1vh 5vh;
  border: none;
  outline: none;
}

#moveCounter{
  font-size: var(--fs);
  color: #8D5131;
}

p{
  margin: 0.5em 0;
}

  </style>
</head>
<body>

  
  <header>
   <img src="nine.png" alt="–î–µ–≤'—è—Ç–Ω–∞—à–∫–∏">
  </header>

<div id="moveCounter">–•–æ–¥—ñ–≤: 0</div>

  <div class="controls">
    <button onclick="newGame()">–ù–æ–≤–∞ –≥—Ä–∞</button>
  </div>

  <div class="grid" id="gameBoard"></div>

  <footer>
    <p>üî¢ –î–µ–≤‚Äô—è—Ç–Ω–∞—à–∫–∏ - —Ü–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è –≥—Ä–∏ ¬´–ø‚Äô—è—Ç–Ω–∞—à–∫–∏¬ª –∑ 19 –ø–ª–∏—Ç–∫–∞–º–∏ –Ω–∞ –ø–æ–ª—ñ 4x5 –∞–±–æ 5√ó4.</p><p>–ú–µ—Ç–∞ - –≤–ø–æ—Ä—è–¥–∫—É–≤–∞—Ç–∏ —á–∏—Å–ª–∞, –ø–µ—Ä–µ—Å—É–≤–∞—é—á–∏ –ø–ª–∏—Ç–∫–∏ —É –ø–æ—Ä–æ–∂–Ω—é –∫–ª—ñ—Ç–∏–Ω–∫—É. –ü—Ä–æ—Å—Ç–æ, –∞–ª–µ –∑–∞—Ç—è–≥—É—î!</p>
  </footer>

  <script>
    const board = document.getElementById('gameBoard');
    let tiles = [];
    let moveCount = 0;

  function updateCounter() {
  document.getElementById('moveCounter').textContent = `–•–æ–¥—ñ–≤: ${moveCount}`;
}
  function newGame() {
  tiles = [...Array(19).keys()].map(n => n + 1);
  tiles.push(null); // –ø—É—Å—Ç–∞—è —è—á–µ–π–∫–∞
  shuffle(tiles);
  moveCount = 0;     // —Å–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–∞
  updateCounter();   // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  render();
}

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function render() {
      board.innerHTML = '';
      tiles.forEach((num, i) => {
        const cell = document.createElement('div');
        cell.className = 'cell' + (num === null ? ' empty' : '');
        if (num !== null) {
          cell.innerHTML = `<span>${num}</span>`;
          cell.onclick = () => move(i);
        }
        board.appendChild(cell);
      });
    }

    function move(index) {
      const emptyIndex = tiles.indexOf(null);
      const cols = window.matchMedia("(orientation: landscape)").matches ? 5 : 4;
      const rows = 5 * 4 / cols;

      const isAdjacent = (i1, i2) => {
        const x1 = i1 % cols, y1 = Math.floor(i1 / cols);
        const x2 = i2 % cols, y2 = Math.floor(i2 / cols);
        return (Math.abs(x1 - x2) + Math.abs(y1 - y2)) === 1;
      };

      if (isAdjacent(index, emptyIndex)) {
  [tiles[index], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[index]];
  moveCount++;       // —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞
  updateCounter();   // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  render();

  if (checkWin()) {
  setTimeout(() => {
    alert("–í—ñ—Ç–∞—î–º–æ! –í–∏ –∑—ñ–±—Ä–∞–ª–∏ —É—Å—ñ –ø–ª–∏—Ç–∫–∏!");
  }, 100); // –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
}

}
    }
    newGame();

    function checkWin() {
  for (let i = 0; i < 19; i++) {
    if (tiles[i] !== i + 1) return false;
  }
  return tiles[19] === null;
}

/*–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∞*/
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/wave-sand/sw.js')
    .then(() => console.log('SW –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
    .catch(error => console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ SW:', error));
}

  </script>

</body>
</html>